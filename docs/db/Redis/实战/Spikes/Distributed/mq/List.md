# List模拟消息队列

list是redis的一个基本类型，组成是一个双向队列

## 模拟队列

双向队列模拟一个队列只需要保证先进先出即可

即`Lpush`与`Rpop`

或`RPOP`与`RPUSH`配合使用即可

```shell
127.0.0.1:6379> LPUSH queue 10 20 30
(integer) 3
127.0.0.1:6379> Rpop queue
"10"
127.0.0.1:6379>  Rpop queue
"20"
```



## 模拟阻塞队列

单纯使用以上方法不能实现阻塞，redis有特定的方法可以添加等待时间，等待阻塞时间过期前是否能有元素取出

即`BRPOP`和`BLPOP`

进程1设置等待时间并取出list的bq

```sh
127.0.0.1:6379>  BLPOP bq 20
```

进程2存储

```sh
127.0.0.1:6379> Rpush bq 369
(integer) 1
```

此时进程1：

```sh
127.0.0.1:6379>  BLPOP bq 20
1) "bq"
2) "369"
(10.06s)
```

发现等待了十秒有消息进来了

如果没有消息会返回nil

```sh
127.0.0.1:6379> blpop bq 1
(nil)
(1.06s)
```



## 优缺点

优点

1. 利用redis存储，不受限JVM内存上限
2. Redis有持久化机制，安全性保障
3. 满足消息有序性

缺点：

1. 消息丢失的可能性

   取出消息后线程出错没有处理信息，导致消息丢失

2. 只支持单消费者，某个消费者取出后从队列中消失，其他消费者使用找不到消息



